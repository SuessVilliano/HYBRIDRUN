<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid Runner - Powered by LIV8</title>
    <style>
        /* Styles remain the same as before */
    </style>
</head>
<body>
    <!-- HTML structure remains the same as before -->

    <script>
        // ... (previous variable declarations and setup)

        let platforms = [];
        let jumpStartTime = 0;
        const MAX_JUMP_DURATION = 500; // milliseconds

        function initGame() {
            const difficulty = difficultySelect.value;
            player = {
                x: 50,
                y: canvas.height - 150,
                width: 40,
                height: 40,
                dy: 0,
                jumpPower: -15,
                gravity: 0.6,
                grounded: false
            };
            obstacles = [];
            coins = [];
            platforms = [];
            score = 0;

            switch(difficulty) {
                case 'easy':
                    gameSpeed = 4;
                    targetScore = 100;
                    break;
                case 'medium':
                    gameSpeed = 5;
                    targetScore = 200;
                    break;
                case 'hard':
                    gameSpeed = 6;
                    targetScore = 300;
                    break;
            }

            // Generate initial obstacles and platforms
            for (let i = 0; i < 5; i++) {
                generateObstacle();
                generatePlatform();
            }
        }

        function generateObstacle() {
            obstacles.push({
                x: canvas.width + Math.random() * canvas.width,
                y: canvas.height - 100,
                width: 40,
                height: 50 + Math.random() * 30
            });
        }

        function generatePlatform() {
            platforms.push({
                x: canvas.width + Math.random() * canvas.width,
                y: canvas.height - 200 - Math.random() * 100,
                width: 100,
                height: 20
            });
        }

        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space' && gameActive) {
                if (player.grounded) {
                    startJump();
                }
            }
        });

        document.addEventListener('keyup', function(event) {
            if (event.code === 'Space' && gameActive) {
                endJump();
            }
        });

        function startJump() {
            player.dy = player.jumpPower;
            player.grounded = false;
            jumpStartTime = Date.now();
        }

        function endJump() {
            const jumpDuration = Date.now() - jumpStartTime;
            if (jumpDuration < MAX_JUMP_DURATION) {
                player.dy = Math.max(player.dy, player.jumpPower / 2);
            }
        }

        function update() {
            player.dy += player.gravity;
            player.y += player.dy;

            // Ground collision
            if (player.y + player.height > canvas.height - 50) {
                player.y = canvas.height - player.height - 50;
                player.dy = 0;
                player.grounded = true;
            }

            // Platform collision
            platforms.forEach(platform => {
                if (player.y + player.height <= platform.y && player.y + player.height + player.dy > platform.y &&
                    player.x < platform.x + platform.width && player.x + player.width > platform.x) {
                    player.y = platform.y - player.height;
                    player.dy = 0;
                    player.grounded = true;
                }
            });

            // Move and check obstacles
            obstacles.forEach((obstacle, index) => {
                obstacle.x -= gameSpeed;
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(index, 1);
                    generateObstacle();
                }
                if (collision(player, obstacle)) {
                    gameOver();
                }
            });

            // Move and check platforms
            platforms.forEach((platform, index) => {
                platform.x -= gameSpeed;
                if (platform.x + platform.width < 0) {
                    platforms.splice(index, 1);
                    generatePlatform();
                }
            });

            // Move and check coins
            coins.forEach((coin, index) => {
                coin.x -= gameSpeed;
                if (coin.x + coin.width < 0) {
                    coins.splice(index, 1);
                }
                if (collision(player, coin)) {
                    score += 10;
                    coins.splice(index, 1);
                    if (score >= targetScore) {
                        victory();
                    }
                }
            });

            // Generate new coins
            if (Math.random() < 0.02 && coins.length < 5) {
                coins.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 200) + 50,
                    width: 20,
                    height: 20
                });
            }
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw player
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // Draw obstacles
            ctx.fillStyle = '#ff0000';
            obstacles.forEach(obstacle => {
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });

            // Draw platforms
            ctx.fillStyle = '#0088ff';
            platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });

            // Draw coins
            ctx.fillStyle = '#ffff00';
            coins.forEach(coin => {
                ctx.beginPath();
                ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width/2, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw ground
            ctx.fillStyle = '#333';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

            // Draw score
            ctx.fillStyle = '#00ffff';
            ctx.font = '24px Arial';
            ctx.fillText('Score: ' + score + ' / ' + targetScore, 20, 40);
        }

        // ... (rest of the code remains the same)

    </script>
</body>
</html>
