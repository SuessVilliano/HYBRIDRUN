<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid Runner - Powered by LIV8</title>
    <style>
        /* Styles remain the same as before */
    </style>
</head>
<body>
    <!-- HTML structure remains the same as before -->

    <script>
        // ... (previous variable declarations and setup)

        let isJumping = false;
        let jumpTimer = 0;
        const MAX_JUMP_TIME = 300; // milliseconds

        function initGame() {
            // ... (initialization code remains the same)
        }

        function startGame() {
            // ... (start game code remains the same)
        }

        function handleJumpStart() {
            if (player.grounded && gameActive) {
                player.dy = player.jumpPower;
                player.grounded = false;
                isJumping = true;
                jumpTimer = 0;
            }
        }

        function handleJumpEnd() {
            isJumping = false;
        }

        // Keyboard controls
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                handleJumpStart();
            }
        });

        document.addEventListener('keyup', function(event) {
            if (event.code === 'Space') {
                handleJumpEnd();
            }
        });

        // Touch controls
        canvas.addEventListener('touchstart', function(event) {
            event.preventDefault();
            handleJumpStart();
        });

        canvas.addEventListener('touchend', function(event) {
            event.preventDefault();
            handleJumpEnd();
        });

        function gameLoop() {
            update();
            draw();
            if (gameActive) {
                requestAnimationFrame(gameLoop);
            }
        }

        function update() {
            if (isJumping) {
                jumpTimer += 16; // Assuming 60 FPS
                if (jumpTimer > MAX_JUMP_TIME) {
                    isJumping = false;
                }
            }

            player.dy += player.gravity;
            if (isJumping && jumpTimer <= MAX_JUMP_TIME) {
                player.dy = player.jumpPower;
            }
            player.y += player.dy;

            if (player.y + player.height > canvas.height - 50) {
                player.y = canvas.height - player.height - 50;
                player.dy = 0;
                player.grounded = true;
            }

            // ... (rest of the update logic remains the same)
        }

        function draw() {
            // ... (drawing logic remains the same)
        }

        // ... (rest of the functions remain the same)

        welcomeScreen.style.display = 'block';
    </script>
</body>
</html>
